// Simulated async operations
const fetchUser = (userId) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (userId) {
        resolve({ id: userId, name: 'John Doe' });
      } else {
        reject(new Error('User ID is required'));
      }
    }, 100);
  });
};

const fetchPosts = (userId) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (userId) {
        resolve([
          { id: 1, title: 'Post 1', userId },
          { id: 2, title: 'Post 2', userId }
        ]);
      } else {
        reject(new Error('User ID is required for fetching posts'));
      }
    }, 100);
  });
};

const fetchComments = (postId) => {
  return new Promise((resolve, reject) => {
    setTimeout(() => {
      if (postId) {
        resolve([
          { id: 1, text: 'Comment 1', postId },
          { id: 2, text: 'Comment 2', postId }
        ]);
      } else {
        reject(new Error('Post ID is required for fetching comments'));
      }
    }, 100);
  });
};

// Main function using async/await with proper error handling
const getUserData = async (userId) => {
  try {
    const user = await fetchUser(userId);
    console.log('User:', user);

    try {
      const posts = await fetchPosts(user.id);
      console.log('Posts:', posts);

      const allComments = [];
      for (const post of posts) {
        try {
          const comments = await fetchComments(post.id);
          allComments.push({ postId: post.id, comments });
        } catch (error) {
          console.error(`Error fetching comments for post ${post.id}:`, error.message);
        }
      }

      console.log('All Comments:', allComments);
      return { user, posts, comments: allComments };
    } catch (error) {
      console.error('Error fetching posts:', error.message);
      throw error;
    }
  } catch (error) {
    console.error('Error fetching user:', error.message);
    throw error;
  }
};

// Execute with error handling
(async () => {
  try {
    const result = await getUserData(1);
    console.log('Final Result:', result);
  } catch (error) {
    console.error('Operation failed:', error.message);
  }
})();